# upravena tabulka economies tak, aby generovala nejnovejsi data, kdy data k roku 2020 nejsou
with e1 as (select country, max(`year`) as "year", gini from economies
where gini is not null 
group by country),
e2 as (select country, max(`year`) as "year", round (GDP/population,1) as GDP_per_capita from economies
where GDP is not null 
group by country),
e3 as (select country, max(`year`) as "year", mortaliy_under5 as mortality_under5 from economies
where mortaliy_under5 is not null 
group by country)
select a.*, c.population_density, e1.gini, e2.GDP_per_capita, e3.mortality_under5,m.median_age_2018,
#casove promenne
case when weekday(a.`date`) in (0,1,2,3,4) then 0
else 1
end as `workday/weekday`, 
case when month(a.`date`) in (12, 1, 2) then 4
	when month(a.`date`) in (3, 4, 5) then 3
    when month(a.`date`) in (6, 7, 8) then 2
	when month(a.`date`) in (9, 10, 11) then 1
 end as season
from covid19_basic_differences as a
left join countries c on c.country=a.country
left join e1 on e1.country=a.country
left join e2 on e2.country=a.country
left join e3 on e3.country=a.country
left join median_age as m on m.abbreviation=c.abbreviation
order by a.country
limit 1000; 

